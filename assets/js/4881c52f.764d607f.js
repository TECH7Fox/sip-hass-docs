"use strict";(self.webpackChunksip_hass_docs=self.webpackChunksip_hass_docs||[]).push([[6686],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return m}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),d=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=d(e.components);return a.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=d(t),m=i,h=u["".concat(s,".").concat(m)]||u[m]||p[m]||o;return t?a.createElement(h,r(r({ref:n},c),{},{components:t})):a.createElement(h,r({ref:n},c))}));function m(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var d=2;d<o;d++)r[d]=t[d];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},3665:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return d},toc:function(){return p}});var a=t(7462),i=t(3366),o=(t(7294),t(3905)),r=["components"],l={sidebar_position:2,title:"Doorbell",tags:["Dialplan","SIP Device","Video","Doorbell"]},s=void 0,d={unversionedId:"add-on/guides/doorbell",id:"add-on/guides/doorbell",title:"Doorbell",description:"If you have a SIP doorbell, you can connect it to the add-on.",source:"@site/docs/add-on/guides/doorbell.md",sourceDirName:"add-on/guides",slug:"/add-on/guides/doorbell",permalink:"/sip-hass-docs/docs/add-on/guides/doorbell",editUrl:"https://github.com/TECH7Fox/sip-hass-docs/edit/main/docs/add-on/guides/doorbell.md",tags:[{label:"Dialplan",permalink:"/sip-hass-docs/docs/tags/dialplan"},{label:"SIP Device",permalink:"/sip-hass-docs/docs/tags/sip-device"},{label:"Video",permalink:"/sip-hass-docs/docs/tags/video"},{label:"Doorbell",permalink:"/sip-hass-docs/docs/tags/doorbell"}],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Doorbell",tags:["Dialplan","SIP Device","Video","Doorbell"]},sidebar:"addonSidebar",previous:{title:"Dahua VTO Doorbell",permalink:"/sip-hass-docs/docs/add-on/guides/devices/dahua_vto_doorbell"},next:{title:"DNS Rewrite",permalink:"/sip-hass-docs/docs/add-on/guides/dns_rewrite"}},c={},p=[{value:"Requirements",id:"requirements",level:2},{value:"Create PJSIP contact",id:"create-pjsip-contact",level:2},{value:"Dialplan",id:"dialplan",level:2},{value:"Dial",id:"dial",level:3},{value:"Parking",id:"parking",level:3},{value:"Conference",id:"conference",level:3},{value:"Redial",id:"redial",level:3},{value:"Another Redial Example",id:"another-redial-example",level:3}],u={toc:p};function m(e){var n=e.components,t=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"If you have a SIP doorbell, you can connect it to the add-on."),(0,o.kt)("h2",{id:"requirements"},"Requirements"),(0,o.kt)("p",null,"For this guide you will need the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Working Add-on"),(0,o.kt)("li",{parentName:"ul"},"Doorbell or other SIP device")),(0,o.kt)("h2",{id:"create-pjsip-contact"},"Create PJSIP contact"),(0,o.kt)("p",null,"First, create a extension for your device in ",(0,o.kt)("inlineCode",{parentName:"p"},"pjsip_custom.conf"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-editorconfig",metastring:'title="pjsip_custom.conf"',title:'"pjsip_custom.conf"'},'[8000]\ntype = endpoint\ncontext = default\ndisallow = all\nallow = alaw,ulaw          ; Audio codecs\nallow=h264                 ; Video codecs\ndirect_media_method=invite\ndtmf_mode=info\ncallerid="Doorbell" <8000>\nforce_rport=no\naors= 8000\nauth = auth8000\n\n[8000]\ntype = aor\nmax_contacts = 1\n\n[auth8000]\ntype=auth\nauth_type=userpass\npassword=mypassword        ; Set your password here\nusername=8000\n')),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Depending on your devices, you might want to change the codecs."))),(0,o.kt)("p",null,"Restart the add-on, and check the logs if the doorbell registers."),(0,o.kt)("h2",{id:"dialplan"},"Dialplan"),(0,o.kt)("p",null,"Now we need to choose and configure a dialplan to send the call to the right place. This could be complicated depending on if you have a 24/7 registered extension."),(0,o.kt)("p",null,"The dialplan is set in ",(0,o.kt)("inlineCode",{parentName:"p"},"extensions.conf"),"."),(0,o.kt)("h3",{id:"dial"},"Dial"),(0,o.kt)("p",null,"If you do have a device which is always registered to accept incoming calls, you can use the normal ",(0,o.kt)("strong",{parentName:"p"},"Dial")," function."),(0,o.kt)("p",null,"The add-on already has a default dialplan extension that calls the extension your trying to reach."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-editorconfig",metastring:'title="extensions.conf"',title:'"extensions.conf"'},"exten => _X!,1,Dial(${PJSIP_DIAL_CONTACTS(${EXTEN})})\n")),(0,o.kt)("p",null,"You can also dial to multiple devices, and it will connect to the first one to pickup."),(0,o.kt)("p",null,"More info about dial ",(0,o.kt)("a",{href:"https://wiki.asterisk.org/wiki/display/AST/Asterisk+13+Application_Dial"},"here"),"."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This only works if the device your calling is registered."))),(0,o.kt)("h3",{id:"parking"},"Parking"),(0,o.kt)("p",null,"With parking, the doorbell parks itself and wait for the other to retrieve the call.\nThe add-on includes a parking extension by default, so you only need to point to it."),(0,o.kt)("p",null,"Simply use it by calling ",(0,o.kt)("inlineCode",{parentName:"p"},"444")," to park, and ",(0,o.kt)("inlineCode",{parentName:"p"},"555")," to pickup a parked call."),(0,o.kt)("p",null,"You can find more info about parking ",(0,o.kt)("a",{href:"../parking/"},"here"),"."),(0,o.kt)("h3",{id:"conference"},"Conference"),(0,o.kt)("p",null,"By using a conference the doorbell also waits for someone else to join the conference room. For this you also need to configure a conference room and users in ",(0,o.kt)("inlineCode",{parentName:"p"},"confbridge.conf"),"."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This option allows calling with ",(0,o.kt)("strong",{parentName:"p"},"multiple devices"),". So more then one person can answer the doorbell. "))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-editorconfig",metastring:'title="confbridge.conf"',title:'"confbridge.conf"'},"[admin_user]\ntype=user\nmarked=yes\nadmin=yes\nmusic_on_hold_when_empty=yes\nquiet=yes\n\n[default_user]\ntype=user\nwait_marked=yes\nend_marked=yes\nmusic_on_hold_when_empty=yes\nquiet=yes\n\n[myconferenceroom]\ntype=bridge\nmax_members=10\n")),(0,o.kt)("p",null,"Then call the room with the correct user from the dialplan."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-editorconfig",metastring:'title="extensions.conf"',title:'"extensions.conf"'},"; for the doorbell\nexten => 777,1,Progress()\nexten => 777,2,Wait(1)\nexten => 777,3,ConfBridge(1,myconferenceroom,default_user)\n\n; for the other user\nexten => 888,1,Progress()\nexten => 888,2,Wait(1)\nexten => 888,3,ConfBridge(1,myconferenceroom,admin_user)\n")),(0,o.kt)("p",null,"Look ",(0,o.kt)("a",{href:"https://wiki.asterisk.org/wiki/display/AST/ConfBridge+Configuration"},"here")," for all the conference settings."),(0,o.kt)("h3",{id:"redial"},"Redial"),(0,o.kt)("p",null,"This is a bit more complicated dialplan, but basicly it tries to call, and if it hangsup because the endpoint isn't registered it tries again after 1 second. And it keeps trying until it tried 60 times."),(0,o.kt)("p",null,"When dialing, you can use the asterisk integration to trigger a automation that sends a notification to your phone to open the sip card."),(0,o.kt)("p",null,"Compared to the park method, this way all endpoints keep ringing. Which could be quite useful if you have a ring group. This also makes this method very useful for if you want to call both the sip cards and softphones."),(0,o.kt)("p",null,"Feel free to tweak the wait time between tries or the amount of tries. And adjust the Dial function for your endpoints."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-editorconfig",metastring:'title="extensions.conf"',title:'"extensions.conf"'},'exten => s,1,NoOp() \n same => n,Set(COUNT=1)\n same => n,While($[ ${COUNT} < 60 ])\n same => n,Set(DIALGROUP(mygroup,add)=PJSIP/6001) \n same => n,Set(DIALGROUP(mygroup,add)=PJSIP/100) \n same => n,Dial(${DIALGROUP(mygroup)},60)\n same => n,Set(HANGUPCAUSEKEYS=${HANGUPCAUSE_KEYS()})\n same => n,Set(HANGUP_CAUSE=${HANGUPCAUSE})\n same => n,GotoIf($["${HANGUP_CAUSE}" == "21"]?exitdialplan)\n same => n,GotoIf($["${HANGUP_CAUSE}" == "0"]?exitdialplan)  \n same => n,Wait(1) \n same => n,SET(COUNT=$[${COUNT} + 1]\n same => n,EndWhile()\n same => n,Verbose(2, HANGUP_CAUSE=${HANGUPCAUSE})\n same => n(exitdialplan),NoOp(Exiting dialplan: HANGUP_CAUSE=${HANGUPCAUSE}) \n same => n,Hangup()\n')),(0,o.kt)("p",null,"A similar function is the ",(0,o.kt)("strong",{parentName:"p"},"RetryDial")," function."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"wait.wav")," is the waiting music.\n",(0,o.kt)("inlineCode",{parentName:"p"},"4")," is the seconds between each try.\n",(0,o.kt)("inlineCode",{parentName:"p"},"10")," is the amount of tries."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-editorconfig",metastring:'title="extensions.conf"',title:'"extensions.conf"'},"exten => 777,1,Progress()\nexten => 777,n,RetryDial(wait.wav,4,10,PJSIP/100) \n")),(0,o.kt)("h3",{id:"another-redial-example"},"Another Redial Example"),(0,o.kt)("p",null,"Here is another redial example that keeps trying until someone answers and hangs up."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-editorconfig",metastring:'title="extensions.conf"',title:'"extensions.conf"'},"exten => 8002,1,Ringing() ; ghost extension number used only for the purpose of redirect, there is no trunk in sip/psjip.conf , this is setup on your VTO config.\nexten => 8002,n(dialing),Dial(${PJSIP_DIAL_CONTACTS(100)}& ${PJSIP_DIAL_CONTACTS(104)}) ;this is so you can dial multiple extensions.\nexten => 8002,n(busy),Playtones(dial) ;the call connects and custom sound is played, but we make it sound the same with the dial ringtone\nexten => 8002,n,Goto(dialing) ; then it repeats itself\nexten => 8002,n,HangUp()\n")))}m.isMDXComponent=!0}}]);