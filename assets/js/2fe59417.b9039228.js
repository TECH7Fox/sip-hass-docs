"use strict";(self.webpackChunksip_hass_docs=self.webpackChunksip_hass_docs||[]).push([[2346],{1067:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"showcase/call_if_left_open","title":"Call if left open","description":"This example makes a call when you leave a window or door open, or leave lights on.","source":"@site/docs/showcase/call_if_left_open.md","sourceDirName":"showcase","slug":"/showcase/call_if_left_open","permalink":"/sip-hass-docs/docs/showcase/call_if_left_open","draft":false,"unlisted":false,"editUrl":"https://github.com/TECH7Fox/sip-hass-docs/edit/main/docs/showcase/call_if_left_open.md","tags":[{"inline":true,"label":"TTS","permalink":"/sip-hass-docs/docs/tags/tts"}],"version":"current","frontMatter":{"tags":["TTS"],"title":"Call if left open"},"sidebar":"showcaseSidebar","previous":{"title":"Introduction","permalink":"/sip-hass-docs/docs/showcase/introduction"}}');var o=n(4848),i=n(8453);const a={tags:["TTS"],title:"Call if left open"},l="Full Automation Example",r={},c=[];function d(e){const t={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"This example makes a call when you leave a window or door open, or leave lights on."}),"\n",(0,o.jsxs)(t.p,{children:["For this to work you simply have to create a group with all window and door / lights entities in your house.\nThen, add a ",(0,o.jsx)(t.strong,{children:"TSS"})," extension to ",(0,o.jsx)(t.code,{children:"extensions.conf"})," (HassIO-Addon) / or ",(0,o.jsx)(t.code,{children:"extensions_custom.conf"})," (FreePBX)"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-editorconfig",metastring:'title="extensions.conf"',children:'[tts]                                          ; The context\nexten => 123,1,Answer()                        ; Answer the call\nexten => 123,n,agi(googletts.agi,"${TEXT}",en) ; Execute the googletts agi script with the TEXT variable\n'})}),"\n",(0,o.jsx)(t.p,{children:"After that, you can make service calls like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title="Service: asterisk.originate"',children:"data:\n  channel: SIP/8002\n  context: tts\n  exten: '123'\n  priority: '1'\n  caller_id: Home Assistant\n  timeout: 60\n  variables:\n    TEXT: \"Attention. The following doors or windows are still open:  {{ dict((states|selectattr('entity_id', 'in', state_attr('group.windows_doors', 'entity_id'))|list)|groupby('state'))['on']|map(attribute='name')|list|join('.......... ') }}\" \n"})}),"\n",(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"full-automation-example",children:"Full Automation Example"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-yaml",metastring:'title="Automation"',children:"- alias: sip - call if lights still on\n  trigger:\n    platform: state\n    entity_id: group.persons\n    from: \"home\"\n    to: \"not_home\"\n    for: \"00:00:03\"\n  condition:\n    - condition: state\n      entity_id: group.windows_doors\n      state: \"on\"\n  action:\n    - service: asterisk.originate\n      data:\n        channel: SIP/8002\n        context: home-assistant-lights\n        exten: '123'\n        priority: '1'\n        caller_id: Home Assistant (Lights On)\n        timeout: 60\n        variables:\n          TEXT: \"Attention. The following lights are still on:  {{ dict((states|selectattr('entity_id', 'in', state_attr('group.lights_house', 'entity_id'))|list)|groupby('state'))['on']|map(attribute='name')|list|join(' ...... ') }}\" \n"})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var s=n(6540);const o={},i=s.createContext(o);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);