"use strict";(self.webpackChunksip_hass_docs=self.webpackChunksip_hass_docs||[]).push([[3386],{7072:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"add-on/guides/doorbell","title":"Doorbell","description":"If you have a SIP doorbell, you can connect it to the add-on.","source":"@site/docs/add-on/guides/doorbell.md","sourceDirName":"add-on/guides","slug":"/add-on/guides/doorbell","permalink":"/sip-hass-docs/docs/add-on/guides/doorbell","draft":false,"unlisted":false,"editUrl":"https://github.com/TECH7Fox/sip-hass-docs/edit/main/docs/add-on/guides/doorbell.md","tags":[{"inline":true,"label":"Dialplan","permalink":"/sip-hass-docs/docs/tags/dialplan"},{"inline":true,"label":"SIP Device","permalink":"/sip-hass-docs/docs/tags/sip-device"},{"inline":true,"label":"Video","permalink":"/sip-hass-docs/docs/tags/video"},{"inline":true,"label":"Doorbell","permalink":"/sip-hass-docs/docs/tags/doorbell"}],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Doorbell","tags":["Dialplan","SIP Device","Video","Doorbell"]},"sidebar":"addonSidebar","previous":{"title":"Dahua VTO Doorbell","permalink":"/sip-hass-docs/docs/add-on/guides/devices/dahua_vto_doorbell"},"next":{"title":"DNS Rewrite","permalink":"/sip-hass-docs/docs/add-on/guides/dns_rewrite"}}');var t=i(4848),s=i(8453);const a={sidebar_position:2,title:"Doorbell",tags:["Dialplan","SIP Device","Video","Doorbell"]},l=void 0,r={},d=[{value:"Requirements",id:"requirements",level:2},{value:"Create PJSIP contact",id:"create-pjsip-contact",level:2},{value:"Dialplan",id:"dialplan",level:2},{value:"Dial",id:"dial",level:3},{value:"Parking",id:"parking",level:3},{value:"Conference",id:"conference",level:3},{value:"Redial",id:"redial",level:3},{value:"Redial Until Answer",id:"redial-until-answer",level:3}];function c(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"If you have a SIP doorbell, you can connect it to the add-on."}),"\n",(0,t.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsx)(n.p,{children:"For this guide you will need the following:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Working Add-on"}),"\n",(0,t.jsx)(n.li,{children:"Doorbell or other SIP device"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"create-pjsip-contact",children:"Create PJSIP contact"}),"\n",(0,t.jsxs)(n.p,{children:["First, create a extension for your device in ",(0,t.jsx)(n.code,{children:"pjsip_custom.conf"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-editorconfig",metastring:'title="pjsip_custom.conf"',children:'[8000]\ntype = endpoint\ncontext = default\ndisallow = all\nallow = alaw,ulaw          ; Audio codecs\nallow=h264                 ; Video codecs\ndirect_media_method=invite\ndtmf_mode=info\ncallerid="Doorbell" <8000>\nforce_rport=no\naors= 8000\nauth = auth8000\n\n[8000]\ntype = aor\nmax_contacts = 1\n\n[auth8000]\ntype=auth\nauth_type=userpass\npassword=mypassword        ; Set your password here\nusername=8000\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"Depending on your devices, you might want to change the codecs."})}),"\n",(0,t.jsx)(n.p,{children:"Restart the add-on, and check the logs if the doorbell registers."}),"\n",(0,t.jsx)(n.h2,{id:"dialplan",children:"Dialplan"}),"\n",(0,t.jsx)(n.p,{children:"Now we need to choose and configure a dialplan to send the call to the right place. This could be complicated depending on if you have a 24/7 registered extension."}),"\n",(0,t.jsxs)(n.p,{children:["The dialplan is set in ",(0,t.jsx)(n.code,{children:"extensions.conf"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"dial",children:"Dial"}),"\n",(0,t.jsxs)(n.p,{children:["If you do have a device which is always registered to accept incoming calls, you can use the normal ",(0,t.jsx)(n.strong,{children:"Dial"})," function."]}),"\n",(0,t.jsx)(n.p,{children:"The add-on already has a default dialplan extension that calls the extension your trying to reach."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-editorconfig",metastring:'title="extensions.conf"',children:"exten => _X!,1,Dial(${PJSIP_DIAL_CONTACTS(${EXTEN})})\n"})}),"\n",(0,t.jsx)(n.p,{children:"You can also dial to multiple devices, and it will connect to the first one to pickup."}),"\n",(0,t.jsxs)(n.p,{children:["More info about dial ",(0,t.jsx)("a",{href:"https://wiki.asterisk.org/wiki/display/AST/Asterisk+13+Application_Dial",children:"here"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"caution",children:(0,t.jsx)(n.p,{children:"This only works if the device your calling is registered."})}),"\n",(0,t.jsx)(n.h3,{id:"parking",children:"Parking"}),"\n",(0,t.jsx)(n.p,{children:"With parking, the doorbell parks itself and wait for the other to retrieve the call.\nThe add-on includes a parking extension by default, so you only need to point to it."}),"\n",(0,t.jsxs)(n.p,{children:["Simply use it by calling ",(0,t.jsx)(n.code,{children:"444"})," to park, and ",(0,t.jsx)(n.code,{children:"555"})," to pickup a parked call."]}),"\n",(0,t.jsxs)(n.p,{children:["You can find more info about parking ",(0,t.jsx)("a",{href:"../parking/",children:"here"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"conference",children:"Conference"}),"\n",(0,t.jsxs)(n.p,{children:["By using a conference the doorbell also waits for someone else to join the conference room. For this you also need to configure a conference room and users in ",(0,t.jsx)(n.code,{children:"confbridge.conf"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["This option allows calling with ",(0,t.jsx)(n.strong,{children:"multiple devices"}),". So more then one person can answer the doorbell."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-editorconfig",metastring:'title="confbridge.conf"',children:"[admin_user]\ntype=user\nmarked=yes\nadmin=yes\nmusic_on_hold_when_empty=yes\nquiet=yes\n\n[default_user]\ntype=user\nwait_marked=yes\nend_marked=yes\nmusic_on_hold_when_empty=yes\nquiet=yes\n\n[myconferenceroom]\ntype=bridge\nmax_members=10\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then call the room with the correct user from the dialplan."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-editorconfig",metastring:'title="extensions.conf"',children:"; for the doorbell\nexten => 777,1,Progress()\nexten => 777,2,Wait(1)\nexten => 777,3,ConfBridge(1,myconferenceroom,default_user)\n\n; for the other user\nexten => 888,1,Progress()\nexten => 888,2,Wait(1)\nexten => 888,3,ConfBridge(1,myconferenceroom,admin_user)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Look ",(0,t.jsx)("a",{href:"https://wiki.asterisk.org/wiki/display/AST/ConfBridge+Configuration",children:"here"})," for all the conference settings."]}),"\n",(0,t.jsx)(n.h3,{id:"redial",children:"Redial"}),"\n",(0,t.jsx)(n.p,{children:"This is a bit more complicated dialplan, but basicly it tries to call, and if it hangsup because the endpoint isn't registered it tries again after 1 second. And it keeps trying until it tried 60 times."}),"\n",(0,t.jsx)(n.p,{children:"When dialing, you can use the asterisk integration to trigger a automation that sends a notification to your phone to open the sip card."}),"\n",(0,t.jsx)(n.p,{children:"Compared to the park method, this way all endpoints keep ringing. Which could be quite useful if you have a ring group. This also makes this method very useful for if you want to call both the sip cards and softphones."}),"\n",(0,t.jsx)(n.p,{children:"Feel free to tweak the wait time between tries or the amount of tries. And adjust the Dial function for your endpoints."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-editorconfig",metastring:'title="extensions.conf"',children:'exten => s,1,NoOp() \n same => n,Set(COUNT=1)\n same => n,While($[ ${COUNT} < 60 ])\n same => n,Set(DIALGROUP(mygroup,add)=PJSIP/6001) \n same => n,Set(DIALGROUP(mygroup,add)=PJSIP/100) \n same => n,Dial(${DIALGROUP(mygroup)},60)\n same => n,Set(HANGUPCAUSEKEYS=${HANGUPCAUSE_KEYS()})\n same => n,Set(HANGUP_CAUSE=${HANGUPCAUSE})\n same => n,GotoIf($["${HANGUP_CAUSE}" == "21"]?exitdialplan)\n same => n,GotoIf($["${HANGUP_CAUSE}" == "0"]?exitdialplan)  \n same => n,Wait(1) \n same => n,SET(COUNT=$[${COUNT} + 1]\n same => n,EndWhile()\n same => n,Verbose(2, HANGUP_CAUSE=${HANGUPCAUSE})\n same => n(exitdialplan),NoOp(Exiting dialplan: HANGUP_CAUSE=${HANGUPCAUSE}) \n same => n,Hangup()\n'})}),"\n",(0,t.jsxs)(n.p,{children:["A similar function is the ",(0,t.jsx)(n.strong,{children:"RetryDial"})," function."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"wait.wav"})," is the waiting music.\n",(0,t.jsx)(n.code,{children:"4"})," is the seconds between each try.\n",(0,t.jsx)(n.code,{children:"10"})," is the amount of tries."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-editorconfig",metastring:'title="extensions.conf"',children:"exten => 777,1,Progress()\nexten => 777,n,RetryDial(wait.wav,4,10,PJSIP/100) \n"})}),"\n",(0,t.jsx)(n.h3,{id:"redial-until-answer",children:"Redial Until Answer"}),"\n",(0,t.jsx)(n.p,{children:"Here is another redial example that keeps trying until someone answers and hangs up."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-editorconfig",metastring:'title="extensions.conf"',children:"exten => 8002,1,Ringing() ; ghost extension number used only for the purpose of redirect, there is no trunk in sip/psjip.conf , this is setup on your VTO config.\nexten => 8002,n(dialing),Dial(${PJSIP_DIAL_CONTACTS(100)}& ${PJSIP_DIAL_CONTACTS(104)}) ;this is so you can dial multiple extensions.\nexten => 8002,n(busy),Playtones(dial) ;the call connects and custom sound is played, but we make it sound the same with the dial ringtone\nexten => 8002,n,Goto(dialing) ; then it repeats itself\nexten => 8002,n,HangUp()\n"})}),"\n",(0,t.jsx)(n.p,{children:"So when somebody pushes the doorbell but none of the dashboard are connected, it will keep dialing untill someone answers.\nLike this you can open the home assistant after a notification and see the incoming call on multiple dashboards, first come, first served."}),"\n",(0,t.jsx)(n.p,{children:"You cannot close the connection unless you answer the call and then hangup."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>l});var o=i(6540);const t={},s=o.createContext(t);function a(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);