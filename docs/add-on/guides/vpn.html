<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-add-on/guides/vpn" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">VPN Guide (WireGuard) | SIP-HASS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://sip-hass-docs.github.io/sip-hass-docs/docs/add-on/guides/vpn"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="VPN Guide (WireGuard) | SIP-HASS"><meta data-rh="true" name="description" content="This guide helps you configure the Asterisk add-on to work properly with VoIP calls over a WireGuard VPN connection. Without proper configuration, you may experience one-way audio or dropped calls when connecting remotely."><meta data-rh="true" property="og:description" content="This guide helps you configure the Asterisk add-on to work properly with VoIP calls over a WireGuard VPN connection. Without proper configuration, you may experience one-way audio or dropped calls when connecting remotely."><link data-rh="true" rel="icon" href="/sip-hass-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://sip-hass-docs.github.io/sip-hass-docs/docs/add-on/guides/vpn"><link data-rh="true" rel="alternate" href="https://sip-hass-docs.github.io/sip-hass-docs/docs/add-on/guides/vpn" hreflang="en"><link data-rh="true" rel="alternate" href="https://sip-hass-docs.github.io/sip-hass-docs/docs/add-on/guides/vpn" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Guides","item":"https://sip-hass-docs.github.io/sip-hass-docs/docs/add-on/guides"},{"@type":"ListItem","position":2,"name":"VPN Guide (WireGuard)","item":"https://sip-hass-docs.github.io/sip-hass-docs/docs/add-on/guides/vpn"}]}</script><link rel="stylesheet" href="/sip-hass-docs/assets/css/styles.63b65bd7.css">
<script src="/sip-hass-docs/assets/js/runtime~main.225d73fe.js" defer="defer"></script>
<script src="/sip-hass-docs/assets/js/main.084e5700.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:dodgerblue;color:white" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">If you like SIP-HASS, please give it a ⭐️ on <a target="_blank" rel="noopener noreferrer" href="https://github.com/TECH7Fox/sip-hass-card">GitHub</a> and consider <a target="_blank" rel="noopener noreferrer" href="https://github.com/sponsors/TECH7Fox">sponsoring</a>.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sip-hass-docs/"><div class="navbar__logo"><img src="/sip-hass-docs/./img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/sip-hass-docs/./img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">SIP-HASS</b></a><a class="navbar__item navbar__link" href="/sip-hass-docs/docs/tutorial/introduction">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sip-hass-docs/docs/add-on/introduction">Add-on</a><a class="navbar__item navbar__link" href="/sip-hass-docs/docs/card/introduction">Cards</a><a class="navbar__item navbar__link" href="/sip-hass-docs/docs/integration/introduction">Integration</a><a class="navbar__item navbar__link" href="/sip-hass-docs/docs/developers/introduction">Developers</a><a class="navbar__item navbar__link" href="/sip-hass-docs/docs/showcase/introduction">Showcase</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://discordapp.com/invite/qxnDtHbwuD" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="Discord community"></a><a href="https://github.com/TECH7Fox/sip-hass-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="Github repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sip-hass-docs/docs/add-on/introduction">Asterisk Add-on</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sip-hass-docs/docs/add-on/settings">⚙️ Add-on Settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sip-hass-docs/docs/add-on/asterisk-settings">🛠️ Asterisk Settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sip-hass-docs/docs/add-on/parking">Parking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/sip-hass-docs/docs/add-on/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/sip-hass-docs/docs/add-on/guides">Guides</a><button aria-label="Collapse sidebar category &#x27;Guides&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/sip-hass-docs/docs/add-on/guides/devices">Devices</a><button aria-label="Expand sidebar category &#x27;Devices&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sip-hass-docs/docs/add-on/guides/doorbell">Doorbell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sip-hass-docs/docs/add-on/guides/dns_rewrite">DNS Rewrite</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sip-hass-docs/docs/add-on/guides/softphone">Softphone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/sip-hass-docs/docs/add-on/guides/vpn">VPN Guide (WireGuard)</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/sip-hass-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/sip-hass-docs/docs/add-on/guides"><span>Guides</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">VPN Guide (WireGuard)</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>VPN Guide (WireGuard)</h1></header><p>This guide helps you configure the Asterisk add-on to work properly with VoIP calls over a WireGuard VPN connection. Without proper configuration, you may experience one-way audio or dropped calls when connecting remotely.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requirements">Requirements<a href="#requirements" class="hash-link" aria-label="Direct link to Requirements" title="Direct link to Requirements">​</a></h2>
<p>For this guide you will need the following:</p>
<ul>
<li>Working Asterisk Add-on</li>
<li>WireGuard Add-on installed and configured</li>
<li>Basic understanding of network configuration</li>
<li>Administrative access to Home Assistant</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>This configuration involves modifying network settings and iptables rules. Make sure you understand the changes before applying them, and have a backup of your current configuration.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="asterisk-add-on-configuration">Asterisk Add-On Configuration<a href="#asterisk-add-on-configuration" class="hash-link" aria-label="Direct link to Asterisk Add-On Configuration" title="Direct link to Asterisk Add-On Configuration">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="transport-configuration">Transport Configuration<a href="#transport-configuration" class="hash-link" aria-label="Direct link to Transport Configuration" title="Direct link to Transport Configuration">​</a></h3>
<p>In the <code>pjsip_custom.conf</code> file, add the transport configuration:</p>
<div class="language-editorconfig codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">pjsip_custom.conf</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-editorconfig codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token section selector punctuation" style="color:#393A34">[</span><span class="token section selector" style="color:#00009f">transport-udp</span><span class="token section selector punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">type</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">transport</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">protocol</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">udp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">bind</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">0.0.0.0:5060  </span><span class="token comment" style="color:#999988;font-style:italic">; Binds to all IP addresses on port 5060</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">; --- Network and NAT Configuration ---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">; This is the most critical part for your use case.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">; Add your local LAN and the VPN subnet here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">; Asterisk will treat any traffic from these networks as internal.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">local_net</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">192.168.1.0/24   </span><span class="token comment" style="color:#999988;font-style:italic">; Your main LAN subnet - CHANGE THIS IF YOU USE A DIFFERENT NETWORK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">local_net</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">172.27.66.0/24   </span><span class="token comment" style="color:#999988;font-style:italic">; The VPN clients virtual addresses subnet - ASSUMING YOU&#x27;RE USING THE DEFAULT WIREGUARD ADD-ON SETTINGS</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Make sure to update the <code>local_net</code> values to match your actual network configuration:</p><ul>
<li>Replace <code>192.168.1.0/24</code> with your actual LAN subnet</li>
<li>Verify the VPN subnet matches your WireGuard configuration</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="extension-template-configuration">Extension Template Configuration<a href="#extension-template-configuration" class="hash-link" aria-label="Direct link to Extension Template Configuration" title="Direct link to Extension Template Configuration">​</a></h3>
<p>In the same <code>pjsip_custom.conf</code> file, modify the extension template section:</p>
<div class="language-editorconfig codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">pjsip_custom.conf</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-editorconfig codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token section selector punctuation" style="color:#393A34">[</span><span class="token section selector" style="color:#00009f">sipjs-ext-endpoint</span><span class="token section selector punctuation" style="color:#393A34">]</span><span class="token plain">(!)   </span><span class="token comment" style="color:#999988;font-style:italic">; &lt;- This is the template header, it should already exist and you should add the following lines under it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">rtp_symmetric</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">force_rport</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">rewrite_contact</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key attr-name" style="color:#00a4db">direct_media</span><span class="token value attr-value punctuation" style="color:#393A34">=</span><span class="token value attr-value" style="color:#e3116c">no</span><br></span></code></pre></div></div>
<p>These settings ensure proper NAT traversal and RTP handling for VPN connections.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wireguard-add-on-configuration">WireGuard Add-On Configuration<a href="#wireguard-add-on-configuration" class="hash-link" aria-label="Direct link to WireGuard Add-On Configuration" title="Direct link to WireGuard Add-On Configuration">​</a></h2>
<p>Add the following configuration to the &quot;Server&quot; section in the WireGuard add-on config page:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">WireGuard Add-on Server Configuration</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">post_up</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -A FORWARD -i %i -j ACCEPT ;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -A FORWARD -o %i -j ACCEPT ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE ;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -t nat -I POSTROUTING 1 -p udp -s 172.30.32.1 -d  172.27.66.0/24 --sport 10000:20000 -j SNAT --to-source &lt;YOUR HOME ASSISTANT IP ADDRESS HERE&gt; ; </span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -t nat -I POSTROUTING 1 -p udp -s 172.27.66.0/24 -d &lt;YOUR HOME ASSISTANT IP ADDRESS HERE&gt; --dport 10000:20000 -j RETURN  </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">post_down</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -D FORWARD -i %i -j ACCEPT ;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -D FORWARD -o %i -j ACCEPT ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE ;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -t nat -D POSTROUTING 1 -p udp -s 172.30.32.1 -d  172.27.66.0/24 --sport 10000:20000 -j SNAT --to-source &lt;YOUR HOME ASSISTANT IP ADDRESS HERE&gt; ; </span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">  iptables -t nat -D POSTROUTING 1 -p udp -s 172.27.66.0/24 -d &lt;YOUR HOME ASSISTANT IP ADDRESS HERE&gt; --dport 10000:20000 -j RETURN  </span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>Important Notes:</strong></p><ol>
<li>Replace <code>&lt;YOUR HOME ASSISTANT IP ADDRESS HERE&gt;</code> with your actual Home Assistant server IP address in <strong>both</strong> the <code>post_up</code> and <code>post_down</code> sections</li>
<li>After saving this configuration, the UI will wrap the text but that&#x27;s expected behavior</li>
<li>These iptables rules handle RTP traffic routing between VPN clients and the Asterisk server</li>
</ol></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="home-assistant-configuration">Home Assistant Configuration<a href="#home-assistant-configuration" class="hash-link" aria-label="Direct link to Home Assistant Configuration" title="Direct link to Home Assistant Configuration">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="shell-command">Shell Command<a href="#shell-command" class="hash-link" aria-label="Direct link to Shell Command" title="Direct link to Shell Command">​</a></h3>
<p>Add the following to your <code>configuration.yaml</code> file:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">configuration.yaml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">shell_command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">add_vpn_rtp_route</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ip route add 172.27.66.0/24 via 172.30.33.3</span><br></span></code></pre></div></div>
<p>This command adds a static route for VPN traffic to ensure proper routing of RTP packets.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="startup-automation">Startup Automation<a href="#startup-automation" class="hash-link" aria-label="Direct link to Startup Automation" title="Direct link to Startup Automation">​</a></h3>
<p>Create the following automation in the Home Assistant UI to ensure the route is added after each restart:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_OeMC">Home Assistant Automation</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">alias</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Add static routes on Home Assistant startup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Add the necessary static route for VOIP calls to work over VPN after a HA restart&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">triggers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">event</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">trigger</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> homeassistant</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">conditions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">actions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">action</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shell_command.add_vpn_rtp_route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> single</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="restart-home-assistant">Restart Home Assistant<a href="#restart-home-assistant" class="hash-link" aria-label="Direct link to Restart Home Assistant" title="Direct link to Restart Home Assistant">​</a></h3>
<p>After making these changes to <code>configuration.yaml</code>, restart Home Assistant to apply the new shell command configuration.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting">​</a></h2>
<p>If you continue to experience issues:</p>
<ol>
<li><strong>Verify network subnets</strong> - Ensure all IP ranges in the configuration match your actual network setup</li>
<li><strong>Check WireGuard logs</strong> - Look for any iptables errors in the WireGuard add-on logs</li>
<li><strong>Test connectivity</strong> - Verify that VPN clients can reach the Home Assistant IP address</li>
<li><strong>Monitor Asterisk logs</strong> - Check for NAT-related warnings or RTP timeout messages</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>After completing this configuration, you should have fully functional audio and video for VoIP calls even when connecting remotely over the WireGuard VPN. The configuration handles the complex NAT traversal and routing requirements that are necessary for real-time media streams.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/sip-hass-docs/docs/tags/vpn">VPN</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/sip-hass-docs/docs/tags/wire-guard">WireGuard</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/sip-hass-docs/docs/tags/network">Network</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/sip-hass-docs/docs/tags/nat">NAT</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/sip-hass-docs/docs/tags/rtp">RTP</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/TECH7Fox/sip-hass-docs/edit/main/docs/add-on/guides/vpn.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/sip-hass-docs/docs/add-on/guides/softphone"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Softphone</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements" class="table-of-contents__link toc-highlight">Requirements</a></li><li><a href="#asterisk-add-on-configuration" class="table-of-contents__link toc-highlight">Asterisk Add-On Configuration</a><ul><li><a href="#transport-configuration" class="table-of-contents__link toc-highlight">Transport Configuration</a></li><li><a href="#extension-template-configuration" class="table-of-contents__link toc-highlight">Extension Template Configuration</a></li></ul></li><li><a href="#wireguard-add-on-configuration" class="table-of-contents__link toc-highlight">WireGuard Add-On Configuration</a></li><li><a href="#home-assistant-configuration" class="table-of-contents__link toc-highlight">Home Assistant Configuration</a><ul><li><a href="#shell-command" class="table-of-contents__link toc-highlight">Shell Command</a></li><li><a href="#startup-automation" class="table-of-contents__link toc-highlight">Startup Automation</a></li><li><a href="#restart-home-assistant" class="table-of-contents__link toc-highlight">Restart Home Assistant</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sip-hass-docs/docs/tutorial/introduction">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/sip-hass-docs/docs/add-on/introduction">Add-on</a></li><li class="footer__item"><a class="footer__link-item" href="/sip-hass-docs/docs/card/introduction">Card</a></li><li class="footer__item"><a class="footer__link-item" href="/sip-hass-docs/docs/integration/introduction">Integration</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Developers</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/sip-hass-docs/docs/developers/add-on/introduction">Add-on</a></li><li class="footer__item"><a class="footer__link-item" href="/sip-hass-docs/docs/developers/card/introduction">Card</a></li><li class="footer__item"><a class="footer__link-item" href="/sip-hass-docs/docs/developers/integration">Integration</a></li><li class="footer__item"><a class="footer__link-item" href="/sip-hass-docs/docs/developers/docs">Docs</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Issues</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/TECH7Fox/asterisk-hass-addons/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Add-on<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/TECH7Fox/sip-hass-card/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Card<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/TECH7Fox/asterisk-hass-integration/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Integration<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/TECH7Fox/sip-hass-docs/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docs<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://community.home-assistant.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home Asssitant forum<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/qxnDtHbwuD" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/TECH7Fox/sip-hass-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/sponsors/TECH7Fox" target="_blank" rel="noopener noreferrer" class="footer__link-item">Become a sponsor<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Jordy Kuhne</div></div></div></footer></div>
</body>
</html>